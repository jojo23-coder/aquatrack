{
  "version": "0.5",
  "note": "Fully embellished 'Coach' persona with restored plant/maintenance logic across all modes.",
  "templating": {
    "syntax": "mustache_like",
    "placeholders": [
      "{{setup.*}}",
      "{{derived.*}}",
      "{{targets.*}}",
      "{{products.<role>.*}}",
      "{{doses.<role>.*}}"
    ]
  },
  "phase_templates": [
    {
      "key": "F1@100",
      "phase_id": "F1",
      "phase_name": "Fishless Setup: Building the Foundation",
      "sequence_number": 100,
      "modifiers_applied": [],
      "atoms": [
        {
          "type": "instruction",
          "text_template": "Welcome to your new aquascape! We are starting 'Fishless' to make the water safe before any animals arrive."
        },
        {
          "type": "instruction",
          "text_template": "Rinse your Inert substrate (sand/gravel) thoroughly in a bucket until the water runs clear. Dust is the enemy of clear water.",
          "conditions": ["setup.substrate_type == 'inert'"]
        },
        {
          "type": "instruction",
          "text_template": "Handle your Aquasoil gently. Do NOT rinse it. Rinsing active soil breaks down the nutrient pellets and turns your tank into a mud bath.",
          "conditions": ["setup.substrate_type == 'aquasoil'"]
        },
        {
          "type": "instruction",
          "text_template": "Rinse your stones to remove loose dust before placing them.",
          "conditions": ["setup.hardscape_type == 'stone' || setup.hardscape_type == 'mixed'"]
        },
        {
          "type": "instruction",
          "text_template": "Soak your driftwood or weigh it down. Dry wood floats! Don't panic if it releases tannins (tea-colored water); this is natural.",
          "conditions": ["setup.hardscape_type == 'wood' || setup.hardscape_type == 'mixed'"]
        },
        {
          "type": "instruction",
          "text_template": "Planting Epiphytes (Anubias/Ferns): Glue or tie them to hardscape. Never bury the rhizome (the thick stem) or it will rot.",
          "conditions": ["setup.plants_present == true", "plants.has_epiphytes == true"]
        },
        {
          "type": "instruction",
          "text_template": "Planting Stems: Trim the bottom inch and plant in small bunches to encourage rooting.",
          "conditions": ["setup.plants_present == true", "plants.has_stems == true"]
        },
        {
          "type": "instruction",
          "text_template": "Time to fill! Place a plastic bag or plate on the substrate and pour water onto *that* to prevent clouding.",
          "conditions": []
        },
        {
          "type": "instruction",
          "text_template": "Since you have chlorine/chloramine, we must treat the full tank volume. If using a hose, add the conditioner to the tank *before* filling.",
          "conditions": ["(source_water.disinfectant == 'chlorine' || source_water.disinfectant == 'chloramine')", "products.detoxifier_conditioner.selected == true"]
        },
        {
          "type": "task",
          "cadence": "one_time",
          "text_template": "Add {{doses.detoxifier_conditioner.fullfill_dose_amount}} {{products.detoxifier_conditioner.dose_unit}} of {{products.detoxifier_conditioner.display_name}}.",
          "conditions": ["(source_water.disinfectant == 'chlorine' || source_water.disinfectant == 'chloramine')", "products.detoxifier_conditioner.selected == true"]
        },
        {
          "type": "task",
          "cadence": "one_time",
          "text_template": "Fill the tank with water.",
          "conditions": []
        },
        {
          "type": "instruction",
          "text_template": "Run the filter 24/7. Oxygen is vital for the bacteria we are about to grow.",
          "conditions": []
        },
        {
          "type": "instruction",
          "text_template": "Set your lights to {{setup.photoperiod_hours_initial}} hours a day. Consistency prevents algae.",
          "conditions": []
        },
        {
          "type": "instruction",
          "text_template": "Keep CO2 OFF for now. Your beneficial bacteria need oxygen, and there are no fish to protect yet.",
          "conditions": ["setup.co2_enabled == true"]
        },
        {
          "type": "task",
          "cadence": "one_time",
          "text_template": "Turn on heater (aim for 24-26°C).",
          "conditions": ["setup.heater_installed == true"]
        },
        {
          "type": "instruction",
          "text_template": "We need to know your starting water chemistry to track the cycle progress.",
          "conditions": []
        },
        {
          "type": "task",
          "cadence": "one_time",
          "text_template": "Measure and log pH.",
          "conditions": []
        },
        {
          "type": "task",
          "cadence": "one_time",
          "text_template": "Measure and log GH and KH.",
          "conditions": []
        },
        {
          "type": "expected_behaviour",
          "text_template": "Don't worry if the water looks cloudy or milky initially. This is usually dust or a 'bacterial bloom'. It will clear up on its own."
        }
      ]
    },
    {
      "key": "F2@200",
      "phase_id": "F2",
      "phase_name": "Ammonia Start: Feeding the Bacteria",
      "sequence_number": 200,
      "modifiers_applied": [],
      "atoms": [
        {
          "type": "instruction",
          "text_template": "It's time to start the cycle! We need to ensure there is ammonia in the water to act as 'food' for your beneficial bacteria."
        },
        {
          "type": "instruction",
          "text_template": "Your goal is to reach {{targets.cycle_ammonia_target_ppm_range}} ppm. Once at this level, we stop dosing and wait for the bacteria to consume it."
        },
        {
          "type": "instruction",
          "text_template": "Since your substrate is inert, the water is currently clean. You must add the ammonia manually to start the process.",
          "conditions": ["setup.substrate_type == 'inert'", "products.ammonia_source.selected == true"]
        },
        {
          "type": "task",
          "cadence": "one_time",
          "text_template": "Add {{doses.ammonia_source.ammonia_ml_range}} mL of {{products.ammonia_source.display_name}}.",
          "conditions": ["setup.substrate_type == 'inert'", "products.ammonia_source.selected == true"]
        },
        {
          "type": "instruction",
          "text_template": "Your Aquasoil is likely releasing high amounts of ammonia already. We must test before dosing to avoid overdosing the tank.",
          "conditions": ["setup.substrate_type == 'aquasoil'"]
        },
        {
          "type": "task",
          "cadence": "one_time",
          "text_template": "Measure and log Ammonia.",
          "conditions": ["setup.substrate_type == 'aquasoil'"]
        },
        {
          "type": "instruction",
          "text_template": "If your test reads over 2.0 ppm, DO NOT dose ammonia today. If it reads near 0, proceed with the dose below.",
          "conditions": ["setup.substrate_type == 'aquasoil'", "products.ammonia_source.selected == true"]
        },
        {
          "type": "task",
          "cadence": "one_time",
          "text_template": "Only if Ammonia < 2.0 ppm: Add {{doses.ammonia_source.ammonia_ml_range}} mL of {{products.ammonia_source.display_name}}.",
          "conditions": ["setup.substrate_type == 'aquasoil'", "products.ammonia_source.selected == true"]
        },
        {
          "type": "instruction",
          "text_template": "Beneficial bacteria supplements introduce the specific strains of life we are trying to grow.",
          "conditions": ["products.bacteria_starter.selected == true"]
        },
        {
          "type": "task",
          "cadence": "daily",
          "text_template": "Add {{products.bacteria_starter.dose_text}} of {{products.bacteria_starter.display_name}}.",
          "conditions": ["products.bacteria_starter.selected == true"]
        },
        {
          "type": "instruction",
          "text_template": "We test frequently to track the colony's appetite. We are looking for Ammonia to drop and Nitrite to spike.",
          "conditions": []
        },
        {
          "type": "task",
          "cadence": "per_event",
          "text_template": "Measure and log Ammonia.",
          "conditions": ["setup.can_test_ammonia == true"]
        },
        {
          "type": "task",
          "cadence": "per_event",
          "text_template": "Measure and log Nitrite.",
          "conditions": ["setup.can_test_nitrite == true"]
        },
        {
          "type": "instruction",
          "text_template": "Rotting leaves release uncontrolled ammonia and can cause algae issues. Keep the tank clean.",
          "conditions": ["setup.plants_present == true"]
        },
        {
          "type": "task",
          "cadence": "as_needed",
          "text_template": "Remove melting or decaying leaves.",
          "conditions": ["setup.plants_present == true"]
        }
      ]
    },
{
      "key": "F3@300",
      "phase_id": "F3",
      "phase_name": "Nitrite Phase: The Waiting Game",
      "sequence_number": 300,
      "modifiers_applied": [],
      "atoms": [
        {
          "type": "instruction",
          "text_template": "You've entered the 'Nitrite Spike'. Bacteria are actively converting Ammonia into Nitrite. This phase often takes the longest."
        },
        {
          "type": "instruction",
          "text_template": "Do NOT clean your filter. The brown gunk inside is the bacteria colony you are trying to grow. Rinsing it now resets your progress."
        },
        {
          "type": "instruction",
          "text_template": "We must continue feeding the bacteria, but only when they have finished their last meal. Overdosing now can stall the cycle.",
          "conditions": ["products.ammonia_source.selected == true"]
        },
        {
          "type": "task",
          "cadence": "per_event",
          "text_template": "Measure and log Ammonia.",
          "conditions": ["products.ammonia_source.selected == true"]
        },
        {
          "type": "task",
          "cadence": "per_event",
          "text_template": "Only if Ammonia is 0 ppm: Add {{doses.ammonia_source.ammonia_ml_range}} mL of {{products.ammonia_source.display_name}}.",
          "conditions": ["products.ammonia_source.selected == true"]
        },
        {
          "type": "instruction",
          "text_template": "We monitor Nitrite to see the spike rise and eventually fall. Don't panic if it goes off the chart (>5ppm).",
          "conditions": ["setup.can_test_nitrite == true"]
        },
        {
          "type": "task",
          "cadence": "per_event",
          "text_template": "Measure and log Nitrite.",
          "conditions": ["setup.can_test_nitrite == true"]
        },
        {
          "type": "expected_behaviour",
          "text_template": "You might see brown algae (diatoms) appear on the glass or sand. This is ugly but perfectly normal. It usually fades as the tank matures."
        },
        {
          "type": "instruction",
          "text_template": "Water changes are vital during cycling to restore pH buffers (KH) that bacteria consume. If KH drops to 0, the cycle crashes.",
          "conditions": []
        },
        {
          "type": "instruction",
          "text_template": "Prepare your replacement water in a bucket. Treat with conditioner and dissolve any minerals *before* pouring it into the tank.",
          "conditions": []
        },
        {
          "type": "task",
          "cadence": "weekly",
          "text_template": "Add {{doses.detoxifier_conditioner.wc_dose_amount}} {{products.detoxifier_conditioner.dose_unit}} of {{products.detoxifier_conditioner.display_name}} to the bucket.",
          "conditions": ["products.detoxifier_conditioner.selected == true"]
        },
        {
          "type": "task",
          "cadence": "weekly",
          "text_template": "Dissolve {{doses.gh_remineralizer.gh_remineralizer_g_wc_range}} {{products.gh_remineralizer.dose_unit}} of {{products.gh_remineralizer.display_name}} in the bucket.",
          "conditions": ["products.gh_remineralizer.selected == true"]
        },
        {
          "type": "task",
          "cadence": "weekly",
          "text_template": "Dissolve {{doses.kh_buffer.kh_buffer_g_wc_range}} {{products.kh_buffer.dose_unit}} of {{products.kh_buffer.display_name}} in the bucket.",
          "conditions": ["products.kh_buffer.selected == true"]
        },
        {
          "type": "task",
          "cadence": "weekly",
          "text_template": "Perform a {{derived.weekly_water_change_percent_range}}% water change.",
          "conditions": []
        },
        {
          "type": "instruction",
          "text_template": "As water evaporates, minerals stay behind. Top off with pure freshwater (dechlorinated) to prevent minerals from building up too high.",
          "conditions": []
        },
        {
          "type": "task",
          "cadence": "as_needed",
          "text_template": "Top off evaporated water.",
          "conditions": []
        }
      ]
    },
{
      "key": "F4@400",
      "phase_id": "F4",
      "phase_name": "Completion Test: The Final Exam",
      "sequence_number": 400,
      "modifiers_applied": [],
      "atoms": [
        {
          "type": "instruction",
          "text_template": "Your tank seems ready! Nitrite is dropping to zero. To be 100% sure, we run a '24-hour stress test'."
        },
        {
          "type": "instruction",
          "text_template": "We will dose ammonia one last time. If the bacteria can clear BOTH ammonia and nitrite to exactly 0 ppm in 24 hours, your filter is strong enough for fish."
        },
        {
          "type": "task",
          "cadence": "per_event",
          "text_template": "Add {{doses.ammonia_source.ammonia_ml_range}} mL of {{products.ammonia_source.display_name}}.",
          "conditions": ["products.ammonia_source.selected == true"]
        },
        {
          "type": "instruction",
          "text_template": "Wait exactly 24 hours before performing the final tests. Do not test early.",
          "conditions": []
        },
        {
          "type": "task",
          "cadence": "per_event",
          "text_template": "Measure and log Ammonia.",
          "conditions": ["setup.can_test_ammonia == true"]
        },
        {
          "type": "task",
          "cadence": "per_event",
          "text_template": "Measure and log Nitrite.",
          "conditions": ["setup.can_test_nitrite == true"]
        }
      ]
    },
{
      "key": "F5@500",
      "phase_id": "F5",
      "phase_name": "Transition: Ready for Life",
      "sequence_number": 500,
      "modifiers_applied": [],
      "atoms": [
        {
          "type": "instruction",
          "text_template": "Congratulations, your tank is cycled! You can stop dosing ammonia now."
        },
        {
          "type": "instruction",
          "text_template": "We need to perform a large (50%) water change to remove the Nitrates accumulated during the cycle. This resets the water quality for your fish."
        },
        {
          "type": "instruction",
          "text_template": "Important: Do NOT clean your filter media during this cleanup. You need that bacteria population at maximum strength for your new livestock."
        },
        {
          "type": "instruction",
          "text_template": "Prepare your replacement water in a bucket. Treat it with conditioner and dissolve any minerals *before* pouring.",
          "conditions": []
        },
        {
          "type": "task",
          "cadence": "one_time",
          "text_template": "Add {{doses.detoxifier_conditioner.wc_dose_amount}} {{products.detoxifier_conditioner.dose_unit}} of {{products.detoxifier_conditioner.display_name}} to the bucket.",
          "conditions": ["products.detoxifier_conditioner.selected == true"]
        },
        {
          "type": "task",
          "cadence": "one_time",
          "text_template": "Dissolve {{doses.gh_remineralizer.gh_remineralizer_g_wc_range}} {{products.gh_remineralizer.dose_unit}} of {{products.gh_remineralizer.display_name}} in the bucket.",
          "conditions": ["products.gh_remineralizer.selected == true"]
        },
        {
          "type": "task",
          "cadence": "one_time",
          "text_template": "Dissolve {{doses.kh_buffer.kh_buffer_g_wc_range}} {{products.kh_buffer.dose_unit}} of {{products.kh_buffer.display_name}} in the bucket.",
          "conditions": ["products.kh_buffer.selected == true"]
        },
        {
          "type": "task",
          "cadence": "one_time",
          "text_template": "Perform the 50% water change.",
          "conditions": []
        },
        {
          "type": "instruction",
          "text_template": "Now that the water is clean, we can enable your equipment for plant growth.",
          "conditions": ["setup.plants_present == true"]
        },
        {
          "type": "task",
          "cadence": "one_time",
          "text_template": "Increase light timer to {{setup.photoperiod_hours_post_cycle}} hours.",
          "conditions": []
        },
        {
          "type": "instruction",
          "text_template": "Set your CO2 timer to turn ON 1 hour before the lights, and OFF 1 hour before the lights go out. This ensures CO2 is available when photosynthesis begins.",
          "conditions": ["setup.co2_enabled == true"]
        },
        {
        "type": "instruction",
        "text_template": "Start with a low bubble rate (e.g., 1 bubble every 3 seconds). Check the drop checker **2–3 hours after the CO2 turns on**. You are aiming for a **Dark Green** color (Safe). Do not push for 'Lime Green' (Optimal) until your livestock has settled in for at least a week.",
        "conditions": ["setup.co2_enabled == true"]
        },
        {
          "type": "task",
          "cadence": "one_time",
          "text_template": "Turn on CO2.",
          "conditions": ["setup.co2_enabled == true"]
        },
        {
          "type": "instruction",
          "text_template": "Start stocking slowly. Your bacteria colony is strong, but doubling the bioload in one day can cause a crash.",
          "conditions": []
        },
        {
          "type": "instruction",
          "text_template": "Acclimation: Float the bag for 15 mins for temperature, then slowly add tank water to the bag. Never dump bag water into your tank!",
          "conditions": []
        },
        {
          "type": "instruction",
          "text_template": "Wait! Shrimp are extremely sensitive. Even if the cycle is done, wait another 2 weeks for biofilm to mature before adding them.",
          "conditions": ["livestock.has_shrimp == true"]
        },
        {
          "type": "task",
          "cadence": "one_time",
          "text_template": "Add your first batch of fish (NOT shrimp).",
          "conditions": ["livestock.has_shrimp == true"]
        },
        {
          "type": "task",
          "cadence": "one_time",
          "text_template": "Add your first batch of livestock.",
          "conditions": ["livestock.has_shrimp == false"]
        },
        {
          "type": "instruction",
          "text_template": "Since we have performed a large water change, we need to restart the fertilizer routine to feed the plants.",
          "conditions": ["products.fertilizer_micros.selected == true", "setup.plants_present == true"]
        },
        {
          "type": "task",
          "cadence": "weekly",
          "text_template": "Add {{doses.fertilizer_micros.fertilizer_micros_ml_week_start}} mL of {{products.fertilizer_micros.display_name}}.",
          "conditions": ["products.fertilizer_micros.selected == true", "setup.plants_present == true"]
        }
      ]
    },
{
      "key": "DS1@101",
      "phase_id": "DS1",
      "phase_name": "Dark Start Setup: The Patience Method",
      "sequence_number": 101,
      "modifiers_applied": ["dark_start"],
      "atoms": [
        {
          "type": "instruction",
          "text_template": "You are doing a 'Dark Start'. By keeping lights OFF and plants OUT, we prevent algae while the filter matures. It requires patience but guarantees a cleaner start."
        },
        {
          "type": "instruction",
          "text_template": "Do NOT plant anything yet. Keep the tank filled, filter running, heater on, but completely dark. Cover the tank with a blanket or cardboard if the room is bright."
        },
        {
          "type": "instruction",
          "text_template": "Rinse your Inert substrate (sand/gravel) thoroughly in a bucket until the water runs clear. Dust is the enemy of clear water.",
          "conditions": ["setup.substrate_type == 'inert'"]
        },
        {
          "type": "instruction",
          "text_template": "Handle your Aquasoil gently. Do NOT rinse it. Rinsing active soil breaks down the nutrient pellets and turns your tank into a mud bath.",
          "conditions": ["setup.substrate_type == 'aquasoil'"]
        },
        {
          "type": "instruction",
          "text_template": "Rinse your stones to remove loose dust before placing them.",
          "conditions": ["setup.hardscape_type == 'stone' || setup.hardscape_type == 'mixed'"]
        },
        {
          "type": "instruction",
          "text_template": "Soak your driftwood, glue it to rocks, or weigh it down. Dry wood floats! Don't panic if it releases tannins (tea-colored water); this is natural.",
          "conditions": ["setup.hardscape_type == 'wood' || setup.hardscape_type == 'mixed'"]
        },
        {
          "type": "instruction",
          "text_template": "Time to fill! Place a plastic bag or plate on the substrate and pour water onto *that* to prevent clouding.",
          "conditions": []
        },
        {
          "type": "instruction",
          "text_template": "Since you have chlorine/chloramine, we must treat the full tank volume. If using a hose, add the conditioner to the tank *before* filling.",
          "conditions": ["(source_water.disinfectant == 'chlorine' || source_water.disinfectant == 'chloramine')", "products.detoxifier_conditioner.selected == true"]
        },
        {
          "type": "task",
          "cadence": "one_time",
          "text_template": "Add {{doses.detoxifier_conditioner.fullfill_dose_amount}} {{products.detoxifier_conditioner.dose_unit}} of {{products.detoxifier_conditioner.display_name}}.",
          "conditions": ["(source_water.disinfectant == 'chlorine' || source_water.disinfectant == 'chloramine')", "products.detoxifier_conditioner.selected == true"]
        },
        {
          "type": "task",
          "cadence": "one_time",
          "text_template": "Fill the tank with water.",
          "conditions": []
        },
        {
          "type": "instruction",
          "text_template": "Run the filter 24/7. Oxygen is vital for the bacteria.",
          "conditions": []
        },
        {
          "type": "task",
          "cadence": "one_time",
          "text_template": "Turn on heater (aim for 24-26°C).",
          "conditions": ["setup.heater_installed == true"]
        },
        {
          "type": "instruction",
          "text_template": "Verify that all light sources are disabled. Light is the enemy of the Dark Start.",
          "conditions": []
        },
        {
          "type": "task",
          "cadence": "one_time",
          "text_template": "Confirm: Lights Unplugged.",
          "conditions": []
        },
        {
          "type": "task",
          "cadence": "one_time",
          "text_template": "Confirm: CO2 Unplugged.",
          "conditions": ["setup.co2_enabled == true"]
        },
        {
          "type": "instruction",
          "text_template": "We need to know your starting water chemistry to track the cycle progress, so measure and log pH, GH and KH.",
          "conditions": []
        },
        {
          "type": "task",
          "cadence": "one_time",
          "text_template": "Measure and log pH.",
          "conditions": []
        },
        {
          "type": "task",
          "cadence": "one_time",
          "text_template": "Measure and log GH and KH.",
          "conditions": []
        }
      ]
    },
    {
      "key": "DS2@201",
      "phase_id": "DS2",
      "phase_name": "Dark Start Cycling",
      "sequence_number": 201,
      "modifiers_applied": ["dark_start"],
      "atoms": [
        {
          "type": "instruction",
          "text_template": "The tank is now cycling in the dark. There is nothing to look at, but invisible work is happening. Do not be tempted to turn on lights."
        },
        {
          "type": "expected_behaviour",
          "text_template": "Because there is no light, you should see very little algae. You might still see white fungal fuzz on driftwood—this is harmless and will disappear."
        },
        {
          "type": "instruction",
          "text_template": "Since your substrate is inert, the water is currently clean. You must add the ammonia manually to start the process.",
          "conditions": ["setup.substrate_type == 'inert'", "products.ammonia_source.selected == true"]
        },
        {
          "type": "task",
          "cadence": "one_time",
          "text_template": "Add {{doses.ammonia_source.ammonia_ml_range}} mL of {{products.ammonia_source.display_name}}.",
          "conditions": ["setup.substrate_type == 'inert'", "products.ammonia_source.selected == true"]
        },
        {
          "type": "instruction",
          "text_template": "Your Aquasoil is likely releasing high amounts of ammonia already. We must test before dosing to avoid overdosing the tank.",
          "conditions": ["setup.substrate_type == 'aquasoil'"]
        },
        {
          "type": "task",
          "cadence": "one_time",
          "text_template": "Measure and log Ammonia.",
          "conditions": ["setup.substrate_type == 'aquasoil'"]
        },
        {
          "type": "instruction",
          "text_template": "If your test reads over 2.0 ppm, DO NOT dose ammonia today. If it reads near 0, proceed with the dose below.",
          "conditions": ["setup.substrate_type == 'aquasoil'", "products.ammonia_source.selected == true"]
        },
        {
          "type": "task",
          "cadence": "one_time",
          "text_template": "Only if Ammonia < 2.0 ppm: Add {{doses.ammonia_source.ammonia_ml_range}} mL of {{products.ammonia_source.display_name}}.",
          "conditions": ["setup.substrate_type == 'aquasoil'", "products.ammonia_source.selected == true"]
        },
        {
          "type": "instruction",
          "text_template": "Beneficial bacteria supplements introduce the specific strains of life we are trying to grow.",
          "conditions": ["products.bacteria_starter.selected == true"]
        },
        {
          "type": "task",
          "cadence": "daily",
          "text_template": "Add {{products.bacteria_starter.dose_text}} of {{products.bacteria_starter.display_name}}.",
          "conditions": ["products.bacteria_starter.selected == true"]
        }
      ]
    },
    {
      "key": "F2@210",
      "phase_id": "F2",
      "phase_name": "Ammonia Maintenance (Dark Start)",
      "sequence_number": 210,
      "modifiers_applied": ["dark_start"],
      "atoms": [
        {
          "type": "instruction",
          "text_template": "We are now maintaining the ammonia levels while waiting for the bacteria to catch up. Keep the tank dark."
        },
        {
          "type": "instruction",
          "text_template": "Your Aquasoil is likely still releasing ammonia. This is free food for your bacteria—let the soil do the work. You might not need to dose for weeks.",
          "conditions": ["setup.substrate_type == 'aquasoil'"]
        },
        {
          "type": "task",
          "cadence": "per_event",
          "text_template": "Measure and log Ammonia.",
          "conditions": ["setup.can_test_ammonia == true"]
        },
        {
          "type": "instruction",
          "text_template": "If the test reads 0 ppm, the bacteria have finished their meal and need more.",
          "conditions": ["products.ammonia_source.selected == true"]
        },
        {
          "type": "task",
          "cadence": "per_event",
          "text_template": "Only if Ammonia is 0 ppm: Add {{doses.ammonia_source.ammonia_ml_range}} mL of {{products.ammonia_source.display_name}}.",
          "conditions": ["products.ammonia_source.selected == true"]
        },
        {
          "type": "instruction",
          "text_template": "As water evaporates, minerals stay behind. Top off with pure freshwater (dechlorinated) to prevent minerals from building up too high.",
          "conditions": []
        },
        {
          "type": "task",
          "cadence": "as_needed",
          "text_template": "Top off evaporated water.",
          "conditions": []
        }
      ]
    },
{
      "key": "F3@310",
      "phase_id": "F3",
      "phase_name": "Nitrite Phase (Dark Start)",
      "sequence_number": 310,
      "modifiers_applied": ["dark_start"],
      "atoms": [
        {
          "type": "instruction",
          "text_template": "Nitrite is spiking. This phase often takes the longest. The tank must remain dark."
        },
        {
          "type": "instruction",
          "text_template": "Do NOT plant yet! High levels of Ammonia and Nitrite are toxic to plants and will melt their delicate tissues. This is exactly why we are waiting."
        },
        {
          "type": "instruction",
          "text_template": "Do NOT clean your filter. The brown sludge inside is the bacterial colony you are trying to grow."
        },
        {
          "type": "instruction",
          "text_template": "We must continue feeding the bacteria, but only when they have finished their last meal. Overdosing now can stall the cycle.",
          "conditions": ["products.ammonia_source.selected == true"]
        },
        {
          "type": "task",
          "cadence": "per_event",
          "text_template": "Measure and log Ammonia.",
          "conditions": ["products.ammonia_source.selected == true"]
        },
        {
          "type": "task",
          "cadence": "per_event",
          "text_template": "Only if Ammonia is 0 ppm: Add {{doses.ammonia_source.ammonia_ml_range}} mL of {{products.ammonia_source.display_name}}.",
          "conditions": ["products.ammonia_source.selected == true"]
        },
        {
          "type": "task",
          "cadence": "per_event",
          "text_template": "Measure and log Nitrite.",
          "conditions": ["setup.can_test_nitrite == true"]
        },
        {
          "type": "instruction",
          "text_template": "Water changes are still needed to replenish minerals that the bacteria consume. Without minerals (KH), the cycle can stall.",
          "conditions": []
        },
        {
          "type": "task",
          "cadence": "weekly",
          "text_template": "Add {{doses.detoxifier_conditioner.wc_dose_amount}} {{products.detoxifier_conditioner.dose_unit}} of {{products.detoxifier_conditioner.display_name}} to the bucket.",
          "conditions": ["products.detoxifier_conditioner.selected == true"]
        },
        {
          "type": "task",
          "cadence": "weekly",
          "text_template": "Dissolve {{doses.gh_remineralizer.gh_remineralizer_g_wc_range}} {{products.gh_remineralizer.dose_unit}} of {{products.gh_remineralizer.display_name}} in the bucket.",
          "conditions": ["products.gh_remineralizer.selected == true"]
        },
        {
          "type": "task",
          "cadence": "weekly",
          "text_template": "Dissolve {{doses.kh_buffer.kh_buffer_g_wc_range}} {{products.kh_buffer.dose_unit}} of {{products.kh_buffer.display_name}} in the bucket.",
          "conditions": ["products.kh_buffer.selected == true"]
        },
        {
          "type": "task",
          "cadence": "weekly",
          "text_template": "Perform a {{derived.weekly_water_change_percent_range}}% water change.",
          "conditions": []
        },
        {
          "type": "instruction",
          "text_template": "Cover the tank immediately after maintenance to keep the light out.",
          "conditions": []
        },
        {
          "type": "task",
          "cadence": "as_needed",
          "text_template": "Top off evaporated water with freshwater.",
          "conditions": []
        }
      ]
    },
    {
      "key": "F4@410",
      "phase_id": "F4",
      "phase_name": "Completion Test (Dark Start)",
      "sequence_number": 410,
      "modifiers_applied": ["dark_start"],
      "atoms": [
        {
          "type": "instruction",
          "text_template": "The cycle seems finished. Let's verify before we unmask the tank. We need to be 100% sure the filter can handle the bioload."
        },
        {
          "type": "instruction",
          "text_template": "We will dose ammonia one last time. If the bacteria can clear BOTH ammonia and nitrite to exactly 0 ppm in 24 hours, we are ready to plant."
        },
        {
          "type": "task",
          "cadence": "per_event",
          "text_template": "The Test: Add {{doses.ammonia_source.ammonia_ml_range}} mL of {{products.ammonia_source.display_name}}.",
          "conditions": ["products.ammonia_source.selected == true"]
        },
        {
          "type": "instruction",
          "text_template": "Wait exactly 24 hours before performing the final tests. Do not test early.",
          "conditions": []
        },
        {
          "type": "task",
          "cadence": "per_event",
          "text_template": "Measure and log Ammonia.",
          "conditions": ["setup.can_test_ammonia == true"]
        },
        {
          "type": "task",
          "cadence": "per_event",
          "text_template": "Measure and log Nitrite.",
          "conditions": ["setup.can_test_nitrite == true"]
        }
      ]
    },
    {
      "key": "DS3@501",
      "phase_id": "DS3",
      "phase_name": "Dark Start Exit: Planting Day",
      "sequence_number": 501,
      "modifiers_applied": ["dark_start", "lighting", "co2_possible"],
      "atoms": [
        {
          "type": "instruction",
          "text_template": "It is finally time! Your filter is mature, and now we can plant the tank without fear of melting or algae."
        },
        {
          "type": "instruction",
          "text_template": "First, drain the tank almost fully (90%). This removes all the accumulated Nitrates and makes planting much easier."
        },
        {
          "type": "task",
          "cadence": "one_time",
          "text_template": "Drain the tank down to the substrate level.",
          "conditions": []
        },
        {
          "type": "instruction",
          "text_template": "Planting Epiphytes (Anubias/Buce): Glue or tie them to hardscape. If you bury the rhizome in the substrate, they will rot.",
          "conditions": ["plants.has_epiphytes == true"]
        },
        {
          "type": "task",
          "cadence": "one_time",
          "text_template": "Plant your Epiphytes.",
          "conditions": ["plants.has_epiphytes == true"]
        },
        {
          "type": "instruction",
          "text_template": "Planting Stems: Trim the bottom inch off and remove lower leaves. Plant in small bunches to encourage new root growth.",
          "conditions": ["plants.has_stems == true"]
        },
        {
          "type": "task",
          "cadence": "one_time",
          "text_template": "Plant your Stems.",
          "conditions": ["plants.has_stems == true"]
        },
        {
          "type": "instruction",
          "text_template": "If you have heavy root feeders (Crypts/Swords), they need food at their feet immediately.",
          "conditions": ["plants.has_root_feeders == true"]
        },
        {
          "type": "task",
          "cadence": "one_time",
          "text_template": "Insert root tabs deep into the substrate beneath the root feeders.",
          "conditions": ["plants.has_root_feeders == true"]
        },
        {
          "type": "instruction",
          "text_template": "Time to refill. Use the 'bag trick' (pour water onto a plastic bag) to avoid blasting your new plants out of the soil.",
          "conditions": []
        },
        {
          "type": "instruction",
          "text_template": "CRITICAL: You must dechlorinate the water. Chlorine will kill the bacteria colony you just spent weeks growing.",
          "conditions": ["(source_water.disinfectant == 'chlorine' || source_water.disinfectant == 'chloramine')"]
        },
        {
          "type": "task",
          "cadence": "one_time",
          "text_template": "Add {{doses.detoxifier_conditioner.fullfill_dose_amount}} {{products.detoxifier_conditioner.dose_unit}} of {{products.detoxifier_conditioner.display_name}} to the tank *before* filling.",
          "conditions": ["(source_water.disinfectant == 'chlorine' || source_water.disinfectant == 'chloramine')", "products.detoxifier_conditioner.selected == true"]
        },
        {
          "type": "task",
          "cadence": "one_time",
          "text_template": "Refill the tank gently.",
          "conditions": []
        },
        {
          "type": "instruction",
          "text_template": "Now we turn the lights on! Start conservatively to prevent an algae shock.",
          "conditions": []
        },
        {
          "type": "task",
          "cadence": "one_time",
          "text_template": "Set light timer to 6 hours.",
          "conditions": []
        },
        {
          "type": "instruction",
          "text_template": "Start CO2 with a low bubble rate (e.g., 1 bubble every 3 seconds). Check the drop checker **2–3 hours after the CO2 turns on**. You are aiming for a **Dark Green** color (Safe).",
          "conditions": ["setup.co2_enabled == true"]
        },
        {
          "type": "task",
          "cadence": "one_time",
          "text_template": "Turn on CO2.",
          "conditions": ["setup.co2_enabled == true"]
        },
        {
          "type": "instruction",
          "text_template": "Your new plants are hungry and need nutrients immediately to recover from planting stress.",
          "conditions": ["products.fertilizer_micros.selected == true"]
        },
        {
          "type": "task",
          "cadence": "one_time",
          "text_template": "Add {{doses.fertilizer_micros.fertilizer_micros_ml_week_start}} mL of {{products.fertilizer_micros.display_name}}.",
          "conditions": ["products.fertilizer_micros.selected == true"]
        }
      ]
    },
    {
      "key": "I1@100",
      "phase_id": "I1",
      "phase_name": "Fish-in Setup: Careful Beginnings",
      "sequence_number": 100,
      "modifiers_applied": [],
      "atoms": [
        {
          "type": "instruction",
          "text_template": "You are cycling with fish ('Fish-in'). This requires daily attention. You are the safety net for your fish until the bacteria grow."
        },
        {
          "type": "instruction",
          "text_template": "Rinse your Inert substrate (sand/gravel) thoroughly until water runs clear.",
          "conditions": ["setup.substrate_type == 'inert'"]
        },
        {
          "type": "instruction",
          "text_template": "Handle your Aquasoil gently. Do NOT rinse it. Rinsing active soil breaks down the pellets.",
          "conditions": ["setup.substrate_type == 'aquasoil'"]
        },
        {
          "type": "instruction",
          "text_template": "Planting Epiphytes (Anubias/Ferns): Glue or tie them to hardscape. Never bury the rhizome.",
          "conditions": ["setup.plants_present == true", "plants.has_epiphytes == true"]
        },
        {
          "type": "instruction",
          "text_template": "Planting Stems: Trim the bottom inch and plant in small bunches.",
          "conditions": ["setup.plants_present == true", "plants.has_stems == true"]
        },
        {
          "type": "instruction",
          "text_template": "Treat the water with conditioner *before* filling the tank. Chlorine will hurt the fish instantly.",
          "conditions": ["(source_water.disinfectant == 'chlorine' || source_water.disinfectant == 'chloramine')"]
        },
        {
          "type": "task",
          "cadence": "one_time",
          "text_template": "Add {{doses.detoxifier_conditioner.fullfill_dose_amount}} {{products.detoxifier_conditioner.dose_unit}} of {{products.detoxifier_conditioner.display_name}}.",
          "conditions": ["(source_water.disinfectant == 'chlorine' || source_water.disinfectant == 'chloramine')", "products.detoxifier_conditioner.selected == true"]
        },
        {
          "type": "task",
          "cadence": "one_time",
          "text_template": "Fill the tank gently.",
          "conditions": []
        },
        {
          "type": "instruction",
          "text_template": "Turn on Filter and Heater (aim for 24-26°C). Ensure temperature is stable *before* adding fish.",
          "conditions": []
        },
        {
          "type": "instruction",
          "text_template": "Set your lights to {{setup.photoperiod_hours_initial}} hours a day.",
          "conditions": []
        },
        {
          "type": "instruction",
          "text_template": "Keep CO2 OFF initially. Your fish are already stressed by the move; adding CO2 now adds suffocation risk.",
          "conditions": ["setup.co2_enabled == true"]
        },
        {
          "type": "instruction",
          "text_template": "CRITICAL WARNING: You are using active Aquasoil with fish. This soil releases heavy ammonia. You must test daily and will likely need 50% water changes every single day for 2 weeks.",
          "conditions": ["setup.substrate_type == 'aquasoil'"]
        },
        {
          "type": "instruction",
          "text_template": "Acclimation is key. Float the bag for 15 mins to match temperature. Then, add a cup of tank water into the bag every 5 minutes for 20 minutes.",
          "conditions": []
        },
        {
          "type": "instruction",
          "text_template": "Net the fish out of the bag and put them in the tank. Discard the bag water—never pour store water into your tank.",
          "conditions": []
        },
        {
          "type": "task",
          "cadence": "one_time",
          "text_template": "Add your fish.",
          "conditions": []
        },
        {
          "type": "instruction",
          "text_template": "Add a double dose of bacteria starter immediately to help protect the fish.",
          "conditions": ["products.bacteria_starter.selected == true"]
        },
        {
          "type": "task",
          "cadence": "one_time",
          "text_template": "Add {{products.bacteria_starter.display_name}} (Check label for 'New Tank' dose).",
          "conditions": ["products.bacteria_starter.selected == true"]
        },
        {
          "type": "instruction",
          "text_template": "Feed VERY lightly—once every 2 days initially. Uneaten food turns into toxic ammonia.",
          "conditions": []
        },
        {
          "type": "task",
          "cadence": "per_event",
          "text_template": "Test Ammonia and Nitrite immediately to get a baseline.",
          "conditions": ["setup.can_test_ammonia == true"]
        }
      ]
    },
    {
      "key": "I1@102",
      "phase_id": "I1",
      "phase_name": "Fish-in Setup (Low Light)",
      "sequence_number": 102,
      "modifiers_applied": ["lighting:minimal"],
      "atoms": [
        {
          "type": "instruction",
          "text_template": "You are cycling with fish ('Fish-in') using a 'Minimal Light' start. This reduces stress on the fish and prevents algae during the unstable early weeks."
        },
        {
          "type": "instruction",
          "text_template": "Rinse your Inert substrate (sand/gravel) thoroughly until water runs clear.",
          "conditions": ["setup.substrate_type == 'inert'"]
        },
        {
          "type": "instruction",
          "text_template": "Handle your Aquasoil gently. Do NOT rinse it.",
          "conditions": ["setup.substrate_type == 'aquasoil'"]
        },
        {
          "type": "instruction",
          "text_template": "Planting Epiphytes (Anubias/Ferns): Glue or tie them to hardscape. Never bury the rhizome.",
          "conditions": ["setup.plants_present == true", "plants.has_epiphytes == true"]
        },
        {
          "type": "instruction",
          "text_template": "Planting Stems: Trim the bottom inch and plant in small bunches.",
          "conditions": ["setup.plants_present == true", "plants.has_stems == true"]
        },
        {
          "type": "instruction",
          "text_template": "Treat the water with conditioner *before* filling the tank.",
          "conditions": ["(source_water.disinfectant == 'chlorine' || source_water.disinfectant == 'chloramine')"]
        },
        {
          "type": "task",
          "cadence": "one_time",
          "text_template": "Add {{doses.detoxifier_conditioner.fullfill_dose_amount}} {{products.detoxifier_conditioner.dose_unit}} of {{products.detoxifier_conditioner.display_name}}.",
          "conditions": ["(source_water.disinfectant == 'chlorine' || source_water.disinfectant == 'chloramine')", "products.detoxifier_conditioner.selected == true"]
        },
        {
          "type": "task",
          "cadence": "one_time",
          "text_template": "Fill the tank gently.",
          "conditions": []
        },
        {
          "type": "instruction",
          "text_template": "Turn on Filter and Heater (aim for 24-26°C).",
          "conditions": []
        },
        {
          "type": "instruction",
          "text_template": "Set your lights to a minimal **4–6 hours** a day. We will ramp this up later once the tank is stable.",
          "conditions": []
        },
        {
          "type": "instruction",
          "text_template": "Keep CO2 OFF initially. Your fish are already stressed; adding CO2 now adds suffocation risk.",
          "conditions": ["setup.co2_enabled == true"]
        },
        {
          "type": "instruction",
          "text_template": "CRITICAL WARNING: You are using active Aquasoil with fish. This soil releases heavy ammonia. You must test daily and will likely need 50% water changes every day for 2 weeks.",
          "conditions": ["setup.substrate_type == 'aquasoil'"]
        },
        {
          "type": "instruction",
          "text_template": "Acclimation: Float bag for 15 mins. Add 1 cup tank water to bag every 5 mins for 20 mins. Net fish out; discard bag water.",
          "conditions": []
        },
        {
          "type": "task",
          "cadence": "one_time",
          "text_template": "Add your fish.",
          "conditions": []
        },
        {
          "type": "task",
          "cadence": "one_time",
          "text_template": "Add {{products.bacteria_starter.display_name}} (Double dose for Day 1 safety).",
          "conditions": ["products.bacteria_starter.selected == true"]
        },
        {
          "type": "instruction",
          "text_template": "Feed VERY lightly—once every 2 days initially.",
          "conditions": []
        },
        {
          "type": "task",
          "cadence": "per_event",
          "text_template": "Test Ammonia and Nitrite immediately.",
          "conditions": ["setup.can_test_ammonia == true"]
        }
      ]
    },
    {
      "key": "I2@200",
      "phase_id": "I2",
      "phase_name": "Fish-in Stabilization: The Safety Watch",
      "sequence_number": 200,
      "modifiers_applied": [],
      "atoms": [
        {
          "type": "instruction",
          "text_template": "Your primary job right now is to keep toxins low. If Ammonia or Nitrite rises above 0.5ppm, the fish are suffering and need your help immediately."
        },
        {
          "type": "task",
          "cadence": "daily",
          "text_template": "Measure and log Ammonia and Nitrite.",
          "conditions": ["setup.can_test_ammonia == true"]
        },
        {
          "type": "instruction",
          "text_template": "Feed your fish very lightly—only what they can eat in 30 seconds. If in doubt, skip a day. Hungry fish are healthier than poisoned fish.",
          "conditions": []
        },
        {
          "type": "task",
          "cadence": "daily",
          "text_template": "Remove any uneaten food or decaying plant leaves immediately.",
          "conditions": []
        },
        {
          "type": "task",
          "cadence": "daily",
          "text_template": "Add {{products.bacteria_starter.display_name}} to support the filter.",
          "conditions": ["products.bacteria_starter.selected == true"]
        },
        {
          "type": "instruction",
          "text_template": "EVALUATE: Did your tests read > 0.5 ppm? If YES, perform the Emergency Protocol below.",
          "conditions": []
        },
        {
          "type": "task",
          "cadence": "as_needed",
          "text_template": "EMERGENCY: Perform a {{50}}% water change. Temperature match carefully!",
          "conditions": []
        },
        {
          "type": "task",
          "cadence": "as_needed",
          "text_template": "Add {{doses.detoxifier_conditioner.ewc_dose_amount}} {{products.detoxifier_conditioner.dose_unit}} of {{products.detoxifier_conditioner.display_name}} to the new water.",
          "conditions": ["products.detoxifier_conditioner.selected == true"]
        },
        {
          "type": "instruction",
          "text_template": "Note: Conditioners only bind ammonia for ~24 hours. You must test again tomorrow.",
          "conditions": ["products.detoxifier_conditioner.selected == true"]
        }
      ]
    },
    {
      "key": "I3@300",
      "phase_id": "I3",
      "phase_name": "Fish-in Biofilter Build",
      "sequence_number": 300,
      "modifiers_applied": [],
      "atoms": [
        {
          "type": "instruction",
          "text_template": "If you are seeing consistent 0 ppm Ammonia readings, your first bacteria colony is working! You can slowly increase feeding to normal levels."
        },
        
        {
          "type": "instruction",
          "text_template": "Don't relax yet. The second phase involves a 'Nitrite Spike'. Nitrite is just as toxic as Ammonia, so keep testing."
        },
        {
          "type": "task",
          "cadence": "per_event",
          "text_template": "Measure and log Ammonia.",
          "conditions": ["setup.can_test_ammonia == true"]
        },
        {
          "type": "task",
          "cadence": "per_event",
          "text_template": "Measure and log Nitrite.",
          "conditions": ["setup.can_test_nitrite == true"]
        },
        {
          "type": "instruction",
          "text_template": "Weekly water changes are essential to remove Nitrate and keep the fish healthy. Prepare your water in a bucket first.",
          "conditions": []
        },
        {
          "type": "task",
          "cadence": "weekly",
          "text_template": "Add {{doses.detoxifier_conditioner.wc_dose_amount}} {{products.detoxifier_conditioner.dose_unit}} of {{products.detoxifier_conditioner.display_name}} to the bucket.",
          "conditions": ["products.detoxifier_conditioner.selected == true"]
        },
        {
          "type": "task",
          "cadence": "weekly",
          "text_template": "Dissolve {{doses.gh_remineralizer.gh_remineralizer_g_wc_range}} {{products.gh_remineralizer.dose_unit}} of {{products.gh_remineralizer.display_name}} in the bucket.",
          "conditions": ["products.gh_remineralizer.selected == true"]
        },
        {
          "type": "task",
          "cadence": "weekly",
          "text_template": "Dissolve {{doses.kh_buffer.kh_buffer_g_wc_range}} {{products.kh_buffer.dose_unit}} of {{products.kh_buffer.display_name}} in the bucket.",
          "conditions": ["products.kh_buffer.selected == true"]
        },
        {
          "type": "task",
          "cadence": "weekly",
          "text_template": "Perform a {{derived.weekly_water_change_percent_range}}% water change.",
          "conditions": []
        },
        {
          "type": "instruction",
          "text_template": "You can clean algae off the glass, but do NOT vacuum the substrate deeply yet. Your bacteria live in the gravel.",
          "conditions": []
        },
        {
          "type": "task",
          "cadence": "weekly",
          "text_template": "Clean glass (optional).",
          "conditions": []
        }
      ]
    },
    {
      "key": "I4@500",
      "phase_id": "I4",
      "phase_name": "Fish-in Transition: Maturity",
      "sequence_number": 500,
      "modifiers_applied": [],
      "atoms": [
        {
          "type": "instruction",
          "text_template": "Your tank has been stable for a while with consistently 0 ppm Ammonia and Nitrite. It is safe to assume the cycle is established."
        },
        {
          "type": "instruction",
          "text_template": "We must increase the light to our target, but we must do it slowly. Sudden jumps in light energy will cause algae blooms because plants cannot adapt that fast."
        },
        {
          "type": "task",
          "cadence": "weekly",
          "text_template": "Ramp Up: Increase your light timer by 30 minutes this week. Repeat weekly until you reach {{setup.photoperiod_hours_post_cycle}} hours.",
          "conditions": []
        },
        {
          "type": "instruction",
          "text_template": "Time to enable your CO2 system. Set the timer to turn ON 1 hour before the lights, and OFF 1 hour before the lights go out.",
          "conditions": ["setup.co2_enabled == true"]
        },
        {
          "type": "instruction",
          "text_template": "Start with a safe, low bubble rate (e.g., 1 bubble every 3 seconds). Check the drop checker **2–3 hours after the CO2 turns on**. You are aiming for a **Dark Green** color (Safe).",
          "conditions": ["setup.co2_enabled == true"]
        },
        {
          "type": "task",
          "cadence": "one_time",
          "text_template": "Turn on CO2.",
          "conditions": ["setup.co2_enabled == true"]
        },
        {
          "type": "instruction",
          "text_template": "You can add more fish now, but only a few at a time. The bacteria need time to multiply to handle the new waste.",
          "conditions": []
        },
        {
          "type": "task",
          "cadence": "per_event",
          "text_template": "Add a small batch of new livestock.",
          "conditions": []
        },
        {
          "type": "instruction",
          "text_template": "With the cycle finished and lights increasing, your plants need food.",
          "conditions": ["products.fertilizer_micros.selected == true", "setup.plants_present == true"]
        },
        {
          "type": "task",
          "cadence": "weekly",
          "text_template": "Start Routine: Add {{doses.fertilizer_micros.fertilizer_micros_ml_week_start}} mL of {{products.fertilizer_micros.display_name}}.",
          "conditions": ["products.fertilizer_micros.selected == true", "setup.plants_present == true"]
        }
      ]
    },
    {
      "key": "PA1@100",
      "phase_id": "PA1",
      "phase_name": "Plant-assisted Setup: Silent Cycling",
      "sequence_number": 100,
      "modifiers_applied": [],
      "atoms": [
        {
          "type": "instruction",
          "text_template": "We are using 'Silent Cycling'. By planting heavily from Day 1, the plants will consume the ammonia directly."
        },
        {
          "type": "instruction",
          "text_template": "Rinse your Inert substrate (sand/gravel) thoroughly until water runs clear.",
          "conditions": ["setup.substrate_type == 'inert'"]
        },
        {
          "type": "instruction",
          "text_template": "Handle your Aquasoil gently. Do NOT rinse it.",
          "conditions": ["setup.substrate_type == 'aquasoil'"]
        },
        {
          "type": "instruction",
          "text_template": "Rinse your hardscape stones and soak your driftwood.",
          "conditions": []
        },
        {
          "type": "instruction",
          "text_template": "Plant as densely as possible. The more plant mass you have, the safer your tank will be."
        },
        {
          "type": "instruction",
          "text_template": "Epiphytes (Anubias/Ferns): Glue or tie them to hardscape. Never bury the rhizome.",
          "conditions": ["plants.has_epiphytes == true"]
        },
        {
          "type": "task",
          "cadence": "one_time",
          "text_template": "Plant your Epiphytes.",
          "conditions": ["plants.has_epiphytes == true"]
        },
        {
          "type": "instruction",
          "text_template": "Stems: Trim the bottom inch and plant in small bunches.",
          "conditions": ["plants.has_stems == true"]
        },
        {
          "type": "task",
          "cadence": "one_time",
          "text_template": "Plant your Stems.",
          "conditions": ["plants.has_stems == true"]
        },
        {
          "type": "task",
          "cadence": "one_time",
          "text_template": "Insert root tabs for heavy root feeders.",
          "conditions": ["plants.has_root_feeders == true"]
        },
        {
          "type": "instruction",
          "text_template": "Treat the water with conditioner *before* filling the tank.",
          "conditions": ["(source_water.disinfectant == 'chlorine' || source_water.disinfectant == 'chloramine')"]
        },
        {
          "type": "task",
          "cadence": "one_time",
          "text_template": "Add {{doses.detoxifier_conditioner.fullfill_dose_amount}} {{products.detoxifier_conditioner.dose_unit}} of {{products.detoxifier_conditioner.display_name}}.",
          "conditions": ["(source_water.disinfectant == 'chlorine' || source_water.disinfectant == 'chloramine')", "products.detoxifier_conditioner.selected == true"]
        },
        {
          "type": "task",
          "cadence": "one_time",
          "text_template": "Fill the tank gently using the 'bag trick'.",
          "conditions": []
        },
        {
          "type": "instruction",
          "text_template": "Turn on Filter and Heater (aim for 24-26°C).",
          "conditions": []
        },
        {
          "type": "instruction",
          "text_template": "Set your lights to {{setup.photoperiod_hours_initial}} hours a day.",
          "conditions": []
        },
        {
          "type": "instruction",
          "text_template": "Keep CO2 OFF for now. We want the plants to adapt to the water chemistry before we boost their metabolism.",
          "conditions": ["setup.co2_enabled == true"]
        },
        {
          "type": "task",
          "cadence": "one_time",
          "text_template": "Verify CO2 is unplugged/OFF.",
          "conditions": ["setup.co2_enabled == true"]
        },
        {
          "type": "instruction",
          "text_template": "Your plants are hungry and the substrate alone isn't enough for the water column feeders.",
          "conditions": ["products.fertilizer_micros.selected == true"]
        },
        {
          "type": "task",
          "cadence": "weekly",
          "text_template": "Start Routine: Add {{doses.fertilizer_micros.fertilizer_micros_ml_week_start}} mL of {{products.fertilizer_micros.display_name}}.",
          "conditions": ["products.fertilizer_micros.selected == true"]
        },
        {
          "type": "task",
          "cadence": "one_time",
          "text_template": "Measure and log pH, GH, and KH.",
          "conditions": []
        }
      ]
    },
{
      "key": "PA1@103",
      "phase_id": "PA1",
      "phase_name": "Plant-assisted Setup (CO2 Start)",
      "sequence_number": 103,
      "modifiers_applied": ["co2:very_low"],
      "atoms": [
        {
          "type": "instruction",
          "text_template": "We are using 'Silent Cycling' with immediate but very cautious CO2 injection. By planting heavily and providing carbon, plants will consume ammonia directly."
        },
        {
          "type": "instruction",
          "text_template": "Rinse your Inert substrate (sand/gravel) thoroughly until water runs clear.",
          "conditions": ["setup.substrate_type == 'inert'"]
        },
        {
          "type": "instruction",
          "text_template": "Handle your Aquasoil gently. Do NOT rinse it.",
          "conditions": ["setup.substrate_type == 'aquasoil'"]
        },
        {
          "type": "instruction",
          "text_template": "Rinse your hardscape stones and soak your driftwood.",
          "conditions": []
        },
        {
          "type": "instruction",
          "text_template": "Plant as densely as possible. The more plant mass you have, the safer your tank will be."
        },
        {
          "type": "instruction",
          "text_template": "Epiphytes (Anubias/Ferns): Glue or tie them to hardscape. Never bury the rhizome.",
          "conditions": ["plants.has_epiphytes == true"]
        },
        {
          "type": "task",
          "cadence": "one_time",
          "text_template": "Plant your Epiphytes.",
          "conditions": ["plants.has_epiphytes == true"]
        },
        {
          "type": "instruction",
          "text_template": "Stems: Trim the bottom inch and plant in small bunches.",
          "conditions": ["plants.has_stems == true"]
        },
        {
          "type": "task",
          "cadence": "one_time",
          "text_template": "Plant your Stems.",
          "conditions": ["plants.has_stems == true"]
        },
        {
          "type": "task",
          "cadence": "one_time",
          "text_template": "Insert root tabs for heavy root feeders.",
          "conditions": ["plants.has_root_feeders == true"]
        },
        {
          "type": "instruction",
          "text_template": "Treat the water with conditioner *before* filling the tank. Chlorine damages plant tissue and kills bacteria.",
          "conditions": ["(source_water.disinfectant == 'chlorine' || source_water.disinfectant == 'chloramine')"]
        },
        {
          "type": "task",
          "cadence": "one_time",
          "text_template": "Add {{doses.detoxifier_conditioner.fullfill_dose_amount}} {{products.detoxifier_conditioner.dose_unit}} of {{products.detoxifier_conditioner.display_name}}.",
          "conditions": ["(source_water.disinfectant == 'chlorine' || source_water.disinfectant == 'chloramine')", "products.detoxifier_conditioner.selected == true"]
        },
        {
          "type": "task",
          "cadence": "one_time",
          "text_template": "Fill the tank gently using the 'bag trick'.",
          "conditions": []
        },
        {
          "type": "instruction",
          "text_template": "Turn on Filter and Heater (aim for 24-26°C).",
          "conditions": []
        },
        {
          "type": "instruction",
          "text_template": "Set your lights to {{setup.photoperiod_hours_initial}} hours a day.",
          "conditions": []
        },
        {
          "type": "instruction",
          "text_template": "Since you are running CO2 from the start, we must be careful not to suffocate beneficial biology while oxygen is low. Set timer to turn ON 1 hour before lights.",
          "conditions": []
        },
        {
          "type": "instruction",
          "text_template": "Set CO2 **very low** (1 bubble / 5 seconds). The drop checker should be **Blue** or **Dark Green** initially. Do NOT aim for Lime Green yet.",
          "conditions": []
        },
        
        {
          "type": "task",
          "cadence": "one_time",
          "text_template": "Turn on CO2.",
          "conditions": []
        },
        {
          "type": "task",
          "cadence": "weekly",
          "text_template": "Start Routine: Add {{doses.fertilizer_micros.fertilizer_micros_ml_week_start}} mL of {{products.fertilizer_micros.display_name}}.",
          "conditions": ["products.fertilizer_micros.selected == true"]
        },
        {
          "type": "task",
          "cadence": "one_time",
          "text_template": "Measure and log pH, GH, and KH.",
          "conditions": []
        }
      ]
    },
    {
      "key": "PA2@200",
      "phase_id": "PA2",
      "phase_name": "Silent Cycle: The Growth Watch",
      "sequence_number": 200,
      "modifiers_applied": [],
      "atoms": [
        {
          "type": "instruction",
          "text_template": "The goal of a Silent Cycle is... silence. If the plants are healthy, you should see 0 Ammonia and 0 Nitrite continuously."
        },
        {
          "type": "expected_behaviour",
          "text_template": "Melting leaves are normal as plants adapt. However, rotting leaves produce ammonia. You must remove them immediately to keep the cycle silent."
        },
        {
          "type": "task",
          "cadence": "as_needed",
          "text_template": "Maintenance: Trim and remove any melting leaves.",
          "conditions": []
        },
        {
          "type": "task",
          "cadence": "per_event",
          "text_template": "Measure Ammonia. If > 0.5ppm, do a 50% water change.",
          "conditions": ["setup.can_test_ammonia == true"]
        },
        {
          "type": "task",
          "cadence": "per_event",
          "text_template": "Measure Nitrite. If > 0.5ppm, do a 50% water change.",
          "conditions": ["setup.can_test_nitrite == true"]
        },
        {
          "type": "task",
          "cadence": "weekly",
          "text_template": "Perform a {{derived.weekly_water_change_percent_range}}% water change to replenish minerals.",
          "conditions": []
        },
        {
          "type": "task",
          "cadence": "weekly",
          "text_template": "Dose {{doses.fertilizer_micros.fertilizer_micros_ml_week_start}} mL of {{products.fertilizer_micros.display_name}}. Do not skip this; plants are your filter.",
          "conditions": ["products.fertilizer_micros.selected == true"]
        },
        {
          "type": "task",
          "cadence": "as_needed",
          "text_template": "Top off evaporated water with freshwater.",
          "conditions": []
        }
      ]
    },
    {
      "key": "PA3@300",
      "phase_id": "PA3",
      "phase_name": "Plant-assisted Stocking: Cleanup Crew",
      "sequence_number": 300,
      "modifiers_applied": [],
      "atoms": [
        {
          "type": "instruction",
          "text_template": "If your tests show 0 ppm Ammonia and Nitrite, and your plants are showing new growth, the tank is ready for the first inhabitants."
        },
        {
          "type": "instruction",
          "text_template": "We start with a 'Cleaning Crew' (Snails, Amano Shrimp, or Otocinclus). Stock light! We want to test the biofilter, not overwhelm it."
        },
        {
          "type": "instruction",
          "text_template": "Acclimation is key. Float the bag for 15 mins to match temperature. Then, add a cup of tank water into the bag every 5 minutes for 20 minutes.",
          "conditions": []
        },
        {
          "type": "instruction",
          "text_template": "Net the animals out of the bag and put them in the tank. Discard the bag water—never pour store water into your tank.",
          "conditions": []
        },
        {
          "type": "task",
          "cadence": "one_time",
          "text_template": "Add your Cleanup Crew.",
          "conditions": []
        },
        {
          "type": "instruction",
          "text_template": "We must monitor the water daily for the next 3 days to ensure the added waste doesn't cause an ammonia spike.",
          "conditions": []
        },
        {
          "type": "task",
          "cadence": "daily",
          "text_template": "Measure Ammonia. If > 0.5ppm, perform a water change immediately.",
          "conditions": ["setup.can_test_ammonia == true"]
        },
        {
          "type": "task",
          "cadence": "weekly",
          "text_template": "Perform a {{derived.weekly_water_change_percent_range}}% water change.",
          "conditions": []
        },
        {
          "type": "task",
          "cadence": "weekly",
          "text_template": "Dose {{doses.fertilizer_micros.fertilizer_micros_ml_week_start}} mL of {{products.fertilizer_micros.display_name}}. Healthy plants = Clean water.",
          "conditions": ["products.fertilizer_micros.selected == true"]
        },
        {
          "type": "task",
          "cadence": "as_needed",
          "text_template": "Top off evaporated water with freshwater.",
          "conditions": []
        }
      ]
    },
    {
      "key": "PA4@500",
      "phase_id": "PA4",
      "phase_name": "Plant-assisted Transition: Maturity",
      "sequence_number": 500,
      "modifiers_applied": [],
      "atoms": [
        {
          "type": "instruction",
          "text_template": "Your ecosystem is established! Your plants are growing and the water is clean. We can now optimize the tank for maximum growth."
        },
        {
          "type": "instruction",
          "text_template": "You can now slowly increase your lighting to the full target duration."
        },
        {
          "type": "task",
          "cadence": "weekly",
          "text_template": "Ramp Up: Increase your light timer by 30 minutes this week. Repeat weekly until you reach {{setup.photoperiod_hours_post_cycle}} hours.",
          "conditions": []
        },
        {
          "type": "instruction",
          "text_template": "If you delayed CO2, start it now. If you started low, you can now increase injection safely.",
          "conditions": ["setup.co2_enabled == true"]
        },
        {
          "type": "instruction",
          "text_template": "Slowly increase the bubble rate. We are now aiming for a **Lime Green** drop checker color (Optimal). Watch your fish closely for gasping!",
          "conditions": ["setup.co2_enabled == true"]
        },
        {
          "type": "task",
          "cadence": "one_time",
          "text_template": "Turn on / Adjust CO2.",
          "conditions": ["setup.co2_enabled == true"]
        },
        {
          "type": "instruction",
          "text_template": "You can now add your main livestock (fish), but continue to do so in small batches.",
          "conditions": []
        },
        {
          "type": "task",
          "cadence": "per_event",
          "text_template": "Add a batch of livestock.",
          "conditions": []
        },
        {
          "type": "instruction",
          "text_template": "As plant mass increases, they will eat more. Watch their leaves for signs of hunger.",
          "conditions": ["products.fertilizer_micros.selected == true"]
        },
        
        {
          "type": "task",
          "cadence": "weekly",
          "text_template": "Diagnostic: If you see pale leaves (Iron deficiency) or pinholes (Potassium deficiency), increase dose to {{doses.fertilizer_micros.fertilizer_micros_ml_week_range}} mL.",
          "conditions": ["products.fertilizer_micros.selected == true"]
        }
      ]
    },
    {
      "key": "R1@600",
      "phase_id": "R1",
      "phase_name": "Routine: The Long Haul",
      "sequence_number": 600,
      "modifiers_applied": [],
      "atoms": [
        {
          "type": "instruction",
          "text_template": "Welcome to the 'Forever' phase. Consistency is key. Regular maintenance prevents 'Old Tank Syndrome' and keeps algae away."
        },
        {
          "type": "instruction",
          "text_template": "Weekly water changes replenish minerals and remove hormones/waste. Always prep your water *before* adding it to the tank.",
          "conditions": []
        },
        {
          "type": "task",
          "cadence": "weekly",
          "text_template": "Add {{doses.detoxifier_conditioner.wc_dose_amount}} {{products.detoxifier_conditioner.dose_unit}} of {{products.detoxifier_conditioner.display_name}} to the bucket.",
          "conditions": ["products.detoxifier_conditioner.selected == true"]
        },
        {
          "type": "task",
          "cadence": "weekly",
          "text_template": "Dissolve {{doses.gh_remineralizer.gh_remineralizer_g_wc_range}} {{products.gh_remineralizer.dose_unit}} of {{products.gh_remineralizer.display_name}} in the bucket.",
          "conditions": ["products.gh_remineralizer.selected == true"]
        },
        {
          "type": "task",
          "cadence": "weekly",
          "text_template": "Dissolve {{doses.kh_buffer.kh_buffer_g_wc_range}} {{products.kh_buffer.dose_unit}} of {{products.kh_buffer.display_name}} in the bucket.",
          "conditions": ["products.kh_buffer.selected == true"]
        },
        {
          "type": "task",
          "cadence": "weekly",
          "text_template": "Perform a {{derived.weekly_water_change_percent_range}}% water change. Vacuum debris from the surface of the substrate.",
          "conditions": []
        },
        {
          "type": "task",
          "cadence": "weekly",
          "text_template": "Dose {{doses.fertilizer_micros.fertilizer_micros_ml_week_start}} mL of {{products.fertilizer_micros.display_name}} (adjust based on plant growth).",
          "conditions": ["products.fertilizer_micros.selected == true", "setup.plants_present == true"]
        },
        {
          "type": "task",
          "cadence": "weekly",
          "text_template": "Test Nitrates. Aim to keep them below 20-30 ppm. If higher, perform a larger water change next time.",
          "conditions": []
        },
        {
          "type": "instruction",
          "text_template": "Once a month, you must clean your filter sponges to maintain flow. NEVER use tap water, as chlorine kills the bacteria.",
          "conditions": []
        },
        {
          "type": "task",
          "cadence": "monthly",
          "text_template": "Rinse filter sponges/media in a bucket of old tank water (discarded during a water change).",
          "conditions": []
        },
        {
          "type": "task",
          "cadence": "monthly",
          "text_template": "Check the heater. Is it holding a stable temperature?",
          "conditions": ["setup.heater_installed == true"]
        },
        {
          "type": "task",
          "cadence": "as_needed",
          "text_template": "Trim stem plants. Replant the tops if you want to increase density.",
          "conditions": ["plants.has_stems == true"]
        },
        {
          "type": "task",
          "cadence": "as_needed",
          "text_template": "Replenish Root Tabs. If growth slows down (usually every 3-4 months), insert fresh tabs.",
          "conditions": ["plants.has_root_feeders == true"]
        },
        {
          "type": "task",
          "cadence": "monthly",
          "text_template": "CO2 Maintenance: Change the drop checker fluid and clean the diffuser disc if bubbles are getting large.",
          "conditions": ["setup.co2_enabled == true"]
        }
      ]
    }
  ]
}